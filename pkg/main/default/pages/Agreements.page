<apex:page id="agreement" controller="AgreementsController" showHeader="true" sidebar="false"
           title="{!$Label.DocuSignAgreements}">

    <apex:includeLightning/>

    <style type="text/css">
        #content {
            background-color: white;
            position: relative;
            height: calc(100vh - 165px);
            overflow: auto;
        }

        .agreementsFooter {
            background: #f3f2f2 !important;
            margin-top: 0px !important;
        }

        .agreementsHeader {
            background: #f3f2f2 !important;
        }

        .agreementsContainer {
            border: 1px solid #dcdbda !important;
            border-radius: .25rem;
        }

        .agreementsBody {
            border-radius: 0px !important;
            border: 0px !important;
        }
    </style>
    <div class="slds-scope" id="content">
        <div class="slds-container_medium slds-container_center">
            <div class="slds-page-header slds-m-bottom_medium slds-m-top_medium agreementsHeader">
                <div class="slds-page-header__row">
                    <div class="slds-page-header__col-title">
                        <div class="slds-media">
                            <div class="slds-media__figure">
                        <span class="{!'slds-icon_container slds-icon-standard-'+sourceObjectName}"
                              title="description of icon when needed"> 
                          <svg aria-hidden="true" class="slds-icon"> 
                            <use xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                                 xlink:href="{!URLFOR($Asset.SLDS, '/assets/icons/standard-sprite/svg/symbols.svg#'+sourceObjectName)}"></use>
                          </svg> 
                           <span class="slds-assistive-text">Icon Assistive Text</span> 
                        </span>
                            </div>
                            <div class="slds-media__body">
                                <div class="slds-page-header__name">
                                    <div class="slds-page-header__name-title">
                                        <h1>
                                    <span class="slds-page-header__title slds-truncate"
                                          title="{!sourceRecord['Name']}">{!sourceRecord['Name']}</span>
                                        </h1>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="agreementsContainer">
                <div id="ds-agreementspage"></div>
                <footer class="slds-card__footer agreementsFooter">
                    <button type="button" class="slds-button slds-button_neutral slds-align_absolute-center"
                            onclick="navigateToSourceRecord('{!JSENCODE($CurrentPage.parameters.sId)}')">{!$Label.Back}
                    </button>
                </footer>
            </div>
        </div>
    </div>

    <script>
      var _namespace = '{!JSENCODE(namespace)}';
      var _navigateToURL = function (event) {
        var url = event.getParam('url');
        window.open(url, '_self');
      };
      $Lightning.use(_namespace + ':AgreementsApp', function () {
        $Lightning.createComponent(_namespace + ':Agreements', {
          visualforce: true, recordId: '{!JSENCODE($CurrentPage.parameters.sId)}'
        }, 'ds-agreementspage', function (cmp) {
          $A.eventService.addHandler({'event': 'force:navigateToURL', 'handler': _navigateToURL});
        });
      });

      function navigateToSourceRecord(sourceId) {
        var myUserContext = "{!$User.UITheme}";
        if (myUserContext === 'Theme4t' || myUserContext === 'Theme4d') {
          // The Visualforce page is in S1 or Lightning Experience
          sforce.one.navigateToSObject(sourceId);
        }
        if (myUserContext === 'Theme3') {
          // The Visualforce page is running in Classic
          window.parent.location = '/' + sourceId;
        }
      }
    </script>
</apex:page>