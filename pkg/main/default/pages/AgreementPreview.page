<apex:page controller="AgreementsController" title="Preview Agreement" sidebar="false" showHeader="true">
    <apex:includeLightning/>
    <apex:slds/>
    <apex:includeScript value="{!$Resource.navUtils}"/>
    <style type="text/css">
        #appContainer {
            background-color: #f7f9fb;
        }

        .noSidebarCell #appContainer {
            min-height: calc(100vh - 120px);
            width: -webkit-fill-available;
        }

        .bodyDiv .outerNoSidebar,
        .noSidebarCell,
        .sidebarCell .fixed {
            padding: 0;
        }

        html body.sfdcBody {
            padding: 0;
        }
    </style>

    <div id="appContainer"/>
    <script type="text/javascript">
      var namespace = '{!JSENCODE(namespace)}';
      var _navigateToURL = function (event) {
        var url = event.getParam('url');
        window.open(url, '_blank');
      };
      var docuSignAdmin = {!IsCurrentUserDocuSignAdmin};
      $Lightning.use(namespace + ':AgreementPreviewApp', function () {
        $Lightning.createComponent(namespace + ':AgreementPreview',
          {
            sourceId: '{!JSENCODE($CurrentPage.parameters.sourceId)}',
            agreementId: '{!JSENCODE($CurrentPage.parameters.agreementId)}',
            currentUserEmail: '{!JSENCODE($User.email)}',
            currentUserDocuSignAdmin: docuSignAdmin
          },
          'appContainer',
          function (component, status, errorMessage) {
            if (errorMessage) {
              //FixMe:Need Design
            }
            $A.eventService.addHandler({
              event: 'force:navigateToSObject',
              handler: function (event) {
                navUtils.navigateToSObject(event.getParams().recordId);
              }
            });
            $A.eventService.addHandler({'event': 'force:navigateToURL', 'handler': _navigateToURL});
          });
      });
    </script>
</apex:page>