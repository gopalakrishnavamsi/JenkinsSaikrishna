<apex:page id="OnlineEditorGenTemplate" sidebar="false" showHeader="false" standardController="GenTemplate__c"
           title="{!$Label.DocuSign}" extensions="GenController" standardStylesheets="false" applyHtmlTag="false">
    <html>
    <apex:includeLightning/>
    <apex:slds/>
    <apex:includeScript value="{!$Resource.jquery}"/>
    <apex:includeScript value="{!URLFOR($Resource.ds_editor, '/ds-editor-salesforce.js')}"/>
    <apex:includeScript value="{!$Resource.scmwidgetsjs}"/>
    <apex:includeScript value="{!$Resource.navUtils}"/>
    <apex:includeScript value="{!$Resource.OnlineEditorJs}"/>
    <apex:form>
        <apex:actionFunction name="setOnlineEditorNameMethod" rerender="renderName,renderName2,renderName3,renderName4">
            <apex:param name="tempConfigName" assignTo="{!templateName}" value=""/>
        </apex:actionFunction>
    </apex:form>

    <script type="application/javascript">
      Visualforce.remoting.timeout = 120000;

      var templateDetails = '{!JSENCODE(templateJson)}';
      var initErrorMessage = '{!JSENCODE(errorMessage)}';

      RemoteActions = {
        deleteTemplate: '{!$RemoteAction.GenController.deleteTemplate}',
        getLayouts: '{!$RemoteAction.GenController.getLayouts}',
        getMergeFields: '{!$RemoteAction.GenController.getMergeFields}',
        updateLayouts: '{!$RemoteAction.GenController.updateLayouts}',
        generateDownloadToken: '{!$RemoteAction.GenController.generateDownloadToken}',
        generateUploadToken: '{!$RemoteAction.GenController.generateUploadToken}',
        getTemplateFolderId: '{!$RemoteAction.GenController.getTemplateFolderId}',
        getSpringTemplateIdInUUIDFormat: '{!$RemoteAction.GenController.getSpringTemplateIdInUUIDFormat}',
        updateTemplateIdInSalesforce: '{!$RemoteAction.GenController.updateTemplate}',
        updateFileDetailsInSalesforce: '{!$RemoteAction.GenController.updateTemplate}',
        getEntityRecords: '{!$RemoteAction.GenController.getEntityRecords}',
        getMergeData: '{!$RemoteAction.GenController.getOnlineEditorMergeData}'
      };

      Configuration = {
        isCreating: !{!editMode},
        isEditing: {!editMode},
        isGenerating: false,
        initError: initErrorMessage,
        hasInitError: initErrorMessage !== null && initErrorMessage !== '',
        namespace: '{!JSENCODE(namespace)}',
        docuSignAccountId: '{!JSENCODE(docuSignAccountId)}',
        docuSignUserId: '{!JSENCODE(docuSignUserId)}',
        docuSignEnvironment: '{!JSENCODE(docuSignEnvironment)}',
        template: templateDetails ? Object.freeze(JSON.parse(templateDetails)) : {},
        layoutActionName: '{!layoutActionName}',
        layoutActionType: '{!layoutActionType}',
        templateListUrl: '{!templateListUrl}'
      };

      Labels = {
        templateCreatedLabel: '{!$Label.OnlineEditorTemplateCreated_1}',
        templatePublishedLabel: '{!$Label.OnlineEditorAfterPublish_1}',
        templateUpdatedLabel: '{!$Label.OnlineEditorTemplateUpdated_1}',
        templateInvalidSourceLabel: '{!$Label.InvalidSource}',
        templateExportDataIsUndefinedLabel: '{!$Label.ExportDataIsUndefinedLabel}',
        templateInvalidPathLabel: '{!$Label.InvalidPathLabel}',
        templateUndefinedLabel: '{!$Label.UndefinedOnlineEditorTemplate}',
        templateSaveValidationLabel: '{!$Label.OnlineEditorSaveValidation}'
      };
    </script>

    <style type="text/css">
        .ds-white-brand {
            background: white;
        }

        .onlineEditorToolbarIcon {
            background: rgb(243, 242, 242);
        }

        .slds-scope .slds-path__link {
            padding: 0;
            height: 32px;
            font-size: 13px;
        }

        .slds-scope .slds-path__item:before, .slds-scope .slds-path__item:after {
            height: 16px;
        }

        .templateConfigContentContainer {
            max-width: 581px;
            margin: auto;
        }

        #templateConfigurationDescriptionInput {
            height: 106px;
            resize: none;
        }

        .col {
            flex: 1 !important;
        }

        #ds-spinner {
            height: calc(100vh - 165px);
        }

        #onlineEditor {
            background: #f9f9f9;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 60px);
        }

        #onlineEditorNext, #onlineEditorPublish {
            background: rgb(36, 99, 209);
            border-color: rgb(36, 99, 209);
        }

        .onlineEditorMainContentHeader {
            font-size: 16px !important;
            color: #080707 !important;;
            font-weight: bold;
        }

        .onlineEditorSubContentHeader {
            font-size: 13px !important;
            color: #080707 !important;;
            font-weight: bold;
        }

        .onlineEditorContentDescription {
            font-size: 13px !important;
            color: #3E3E3C !important;;
        }

        .onlineEditorContentText {
            font-size: 13px !important;
            color: #080707 !important;;
        }

        #onlineEditorButtonNameInput {
            min-width: 340px;
            height: 32px;
        }

        .onlineEditorMainContentContainer {
            border: none !important;
        }

        .slds-truncate {
            height: 100% !important;
        }

        .slds-path__scroller_inner {
            position: sticky;
        }
    </style>

    <div class="slds-scope">
        <div id="toastNotificationContainer"></div>

        <!-- Toolbar -->
        <div id="onlineEditorToolBar" class="slds-page-header slds-border_bottom slds-grid">
            <div class="col">
                <div class="slds-media slds-media_center">
                    <div class="slds-media__figure">
                    <span class="slds-icon_container slds-icon-standard-custom">
                        <img src="{!$Resource.dsdxicon}" class="slds-icon onlineEditorToolbarIcon" alt=""/>
                    </span>
                    </div>
                    <div class="slds-media__body">
                        <div class="slds-page-header__name">
                            <div class="slds-page-header__name-title">
                                <span>{!$Label.TemplateConfigurationLabel}</span>

                                <apex:outputPanel id="renderName3">
                                    <h1 class="slds-page-header__title slds-truncate">
                                        {!templateName}
                                    </h1>
                                </apex:outputPanel>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="slds-path">
                    <div class="slds-grid slds-path__track">
                        <div class="slds-grid slds-path__scroller-container">
                            <div class="slds-path__scroller" role="application">
                                <div class="slds-path__scroller_inner">
                                    <ul class="slds-path__nav" role="listbox" aria-orientation="horizontal">
                                        <li id="onlineEditorStep1" class="slds-path__item  slds-is-incomplete"
                                            role="presentation">
                                            <a id="onlineEditorStepLink1" aria-selected="false"
                                               class="slds-path__link onlineEditor_link"
                                               href="javascript:void(0);" role="option"
                                               tabindex="-1">
                                                <span class="slds-path__stage">
                                                  <svg class="slds-icon slds-icon_x-small" aria-hidden="true">
                                                    <use xmlns="http://www.w3.org/2000/svg"
                                                         xmlns:xlink="http://www.w3.org/1999/xlink"
                                                         xlink:href="{!URLFOR($Asset.SLDS, '/assets/icons/utility-sprite/svg/symbols.svg#check')}"></use>
                                                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path
                                                                  d="M8.8 20.1l-7.6-7.6c-.3-.3-.3-.8 0-1.1l1-1c.2-.2.7-.2 1 0l5.7 5.8c.2.2.5.2.7 0L20.8 4.9c.3-.3.8-.3 1 0l1 1c.3.3.3.7 0 1l-13 13.2c-.3.3-.8.3-1 0z"></path></svg>
                                                  </svg>
                                                </span>
                                                <span class="slds-path__title">{!$Label.CreateLabel}</span>
                                            </a>
                                        </li>
                                        <li id="onlineEditorStep2" class="slds-path__item slds-is-incomplete"
                                            role="presentation">
                                            <a id="onlineEditorStepLink2" aria-selected="false"
                                               class="slds-path__link onlineEditor_link"
                                               href="javascript:void(0);" role="option"
                                               tabindex="-1">
                                                <span class="slds-path__stage">
                                                  <svg class="slds-icon slds-icon_x-small" aria-hidden="true">
                                                    <use xmlns="http://www.w3.org/2000/svg"
                                                         xmlns:xlink="http://www.w3.org/1999/xlink"
                                                         xlink:href="{!URLFOR($Asset.SLDS, '/assets/icons/utility-sprite/svg/symbols.svg#check')}"></use>
                                                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path
                                                                  d="M8.8 20.1l-7.6-7.6c-.3-.3-.3-.8 0-1.1l1-1c.2-.2.7-.2 1 0l5.7 5.8c.2.2.5.2.7 0L20.8 4.9c.3-.3.8-.3 1 0l1 1c.3.3.3.7 0 1l-13 13.2c-.3.3-.8.3-1 0z"></path></svg>
                                                  </svg>
                                                </span>
                                                <span class="slds-path__title">{!$Label.DeployLabel}</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class='slds-float_right'>
                    <!-- Step 1 -->
                    <button id="onlineEditorTemplateCancel" class="slds-button slds-button_neutral">{!$Label.Cancel}</button>
                    <button id="onlineEditorSaveClose" class="slds-button slds-button_brand">{!$Label.Next}</button>
                    <!-- Step 2 -->
                    <button id="onlineEditorPublishCancel" class="slds-button slds-button_neutral">{!$Label.Cancel}</button>
                    <button id="onlineEditorPublish" class="slds-button slds-button_brand">{!$Label.PublishLabel}</button>
                </div>
            </div>
        </div>

        <!-- Step Three -->
        <div id="inputFilePanel">
            <div class="ds-white-brand slds-p-around_xx-large">
                <div class="slds-box onlineEditorMainContentContainer">
                    <div class="slds-grid-vertical templateConfigContentContainer">
                        <label class="slds-form-element__label onlineEditorMainContentHeader"><strong>{!$Label.SetFileNameRules}</strong></label>
                        <div class="slds-form-element__icon">
                            <button id="fileNamingRules" class="slds-button slds-button_icon">
                                <use xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                                     xlink:href="{!URLFOR($Asset.SLDS, '/assets/icons/utility-sprite/svg/symbols.svg#info')}"></use>
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="info">
                                    <path d="M12 .9C5.9.9.9 5.9.9 12s5 11.1 11.1 11.1 11.1-5 11.1-11.1S18.1.9 12 .9zm0 5.6c.8 0 1.4.6 1.4 1.4s-.6 1.4-1.4 1.4-1.4-.6-1.4-1.4.6-1.4 1.4-1.4zm2.3 9.7c0 .2-.2.4-.5.4h-3.6c-.3 0-.5-.1-.5-.4v-.9c0-.3.2-.5.5-.5.2 0 .4-.2.4-.4v-1.9c0-.2-.2-.5-.4-.5-.3 0-.5-.1-.5-.4v-.9c0-.3.2-.5.5-.5h2.7c.3 0 .5.2.5.5v3.7c0 .2.2.4.4.4.3 0 .5.2.5.5v.9z"></path>
                                </svg>
                            </button>
                            <div id="namingHelp" class="slds-popover slds-popover_tooltip slds-nubbin_bottom-left"
                                 role="tooltip"
                                 style="position:absolute;top:-75px;left:-10px;width:500px">
                                <div class="slds-popover__body">{!$Label.OnlineEditorFileToolTip}</div>
                            </div>
                        </div>
                        <div class="slds-col slds-p-vertical_small slds-grid">

                            <div class="slds-grid">
                                <div class="slds-grid-vertical">
                                    <label class="slds-form-element__label" for="fileNameInput">
                                        {!$Label.FileName}</label>
                                    <input type="text" id="fileNameInput" required="" class="slds-input"
                                           maxlength="255"/>
                                </div>
                                <div class="slds-grid-vertical slds-p-horizontal_medium">
                                    <label class="slds-form-element__label" for="fileSuffix">
                                        {!$Label.FileSuffix}</label>
                                    <div class="slds-form-element__control">
                                        <div class="slds-select_container">
                                            <select class="slds-select" id="fileSuffix">
                                                <option value="">{!$Label.SelectAnOptionNoDash}</option>
                                                <option>{!$Label.StartingObjectName}</option>
                                                <option>{!$Label.Date}</option>
                                                <option>{!$Label.StartingObjectNameAndDate}</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div class="slds-col slds-p-top_medium">
                            <label class="slds-form-element__label onlineEditorMainContentHeader"><Strong>{!$Label.AddCustomButton}</Strong></label>
                        </div>
                        <label class="slds-form-element__label onlineEditorContentDescription">{!$Label.OnlineEditorButtonPublishPrompt}</label>

                        <div class="slds-col slds-p-vertical_medium">
                            <label class="slds-form-element__label" for="onlineEditorButtonNameInput">
                                <abbr class="slds-required" title="required">* </abbr>{!$Label.ButtonLabel}</label>
                            <div class="slds-form-element__control">
                                <apex:outputPanel id="renderName4">
                                    <input maxlength="80" type="text" id="onlineEditorButtonNameInput" readonly="" placeholder=""
                                           class="slds-input" value="Generate {!templateName}"/>
                                </apex:outputPanel>
                            </div>
                        </div>
                        <div class="slds-col slds-p-vertical_medium">
                            <label class="slds-form-element__label onlineEditorSubContentHeader" for="datasource">
                                <strong>{!$Label.ShowButtonInPrompt}</strong>
                            </label>
                            <div id="layoutCheckboxes" class="onlineEditorContentText"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="ds-spinner">
            <div role="status" class="slds-spinner slds-spinner_medium slds-spinner_brand">
                <div class="slds-spinner__dot-a"></div>
                <div class="slds-spinner__dot-b"></div>
            </div>
        </div>
    </div>
    <div id="onlineEditor"></div>
    </html>
</apex:page>
