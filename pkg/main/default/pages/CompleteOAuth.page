<apex:page id="CompleteOAuth" controller="SetupController" title="{!$Label.DocuSign}">
    <c:Loading />
    <script>
      function endOAuth(event, result) {
        window.opener.endOAuth(event, result);
        window.close();
      }

      var error = '{!JSENCODE($CurrentPage.parameters.error)}';
      if (error) {
        endOAuth({
          status: false, message: '{!JSENCODE($CurrentPage.parameters.error_message)}' || '{!$Label.ConsentRequired}'
        }, null);
      } else {
        Visualforce.remoting.Manager.invokeAction('{!$RemoteAction.SetupController.completeOAuth}', '{!JSENCODE($CurrentPage.parameters.code)}', '{!JSENCODE($CurrentPage.parameters.state)}', function (result, event) {
          endOAuth(event, result);
        });
      }
    </script>
</apex:page>
