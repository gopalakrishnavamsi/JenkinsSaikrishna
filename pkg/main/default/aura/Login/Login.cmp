<aura:component description="UnifiedAppLogin" controller="SetupController">
    <!-- attributes -->
    <aura:attribute name="login" type="Object"/>
    <aura:attribute name="beginOAuth" type="Object" required="true"/>
    <aura:attribute name="beginSpringOAuth" type="Object" required="true"/>
    <aura:attribute name="steps" type="String[]" access="private"/>
    <aura:attribute name="loading" type="Boolean" default="false" access="private"/>
    <aura:attribute name="isLoggedIn" type="Boolean" default="false" access="private"/>
    <aura:attribute name="isPlatformAuthorized" type="Boolean" default="false" access="private"/>
    <aura:attribute name="platformAuthorizationSettingsFound" type="Boolean" default="false" access="private"/>
    <aura:attribute name="currentStep" type="Integer" access="private"/>
    <aura:attribute name="isCompleted" type="Boolean" access="private"/>
    <aura:attribute name="environment" type="String"/>
    <aura:attribute name="multipleAccountsFound" type="Boolean" default="false" access="private"/>
    <aura:attribute name="selectedAccountNumber" type="Long" access="private"/>
    <aura:attribute name="advancedOptionsExpanded" type="Boolean" access="private"/>
    <aura:attribute name="accountOptions" type="List" access="private"/>
    <aura:attribute name="config" type="Object" access="private"/>
    <aura:attribute name="uiHelper" type="Object"/>

    <!--register events -->
    <aura:registerEvent name="toastEvent" type="c:ToastEvent"/>
    <aura:registerEvent name="loadingEvent" type="c:LoadingEvent"/>
    <aura:registerEvent name="reloadEvent" type="c:ReloadEvent"/>
    <aura:registerEvent name="oauthEvent" type="c:OAuthEvent"/>
    <aura:registerEvent name="springOauthEvent" type="c:OAuthEvent"/>

    <!--register handlers -->
    <aura:handler name="init" value="{!this}" action="{!c.init}"/>
    <aura:handler name="loadingEvent" event="c:LoadingEvent" action="{!c.handleLoadingEvent}"/>
    <aura:handler name="oauthEvent" event="c:OAuthEvent" action="{!c.handleOAuthEvent}"/>
    <aura:handler name="springOauthEvent" event="c:OAuthEvent" action="{!c.handleSpringOAuthEvent}"/>

    <div class="ds-login-component slds-m-bottom_large">
        <div class="slds-container slds-container_medium slds-container_center">
            <div class="slds-m-top_small slds-grid slds-grid_vertical">
                <div class="slds-col slds-align-middle slds-size_1-of-1">
                    <!--Path Header -->
                    <div class="slds-text-align_center ds-unifiedApp-login-path-header">
                        Connect DocuSign to Salesforce
                    </div>
                    <!--Path, Check if additional classes are to be added for spinners and padding according to the Gen template component -->
                    <div class="slds-path slds-p-top_medium">
                        <div class="slds-grid slds-path__track slds-is-relative">
                            <div class="slds-grid slds-path__scroller-container">
                                <div class="slds-path__scroller" role="application">
                                    <div class="slds-path__scroller_inner">
                                        <ul class="slds-path__nav" role="tablist">
                                            <aura:iteration items="{!v.steps}" var="step" indexVar="index">
                                                <li class="{!'slds-path__item'
                                                    + if( index gt (v.config.stepsCompleted + 1), ' ds-cursor_not-allowed')
                                                    + if(v.currentStep == index, ' slds-is-active slds-is-current', if(v.currentStep > index, ' slds-is-complete', ' slds-is-incomplete'))}"
                                                    role="presentation">
                                                    <a class="slds-path__link" role="tab"
                                                       tabindex="-1"
                                                       onclick="{!c.selectStep}" data-step="{!index}">
                                                <span class="slds-path__stage">
                                                    <lightning:icon iconName="utility:check" size="x-small"
                                                                    variant="inverse"/>
                                                </span>
                                                        <span class="slds-path__title">{!step}</span>
                                                    </a>
                                                </li>
                                            </aura:iteration>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="slds-m-top_large ">
                    <aura:if isTrue="{!v.loading}">
                        <!-- spinner -->
                        <div class="slds-col slds-m-top_small slds-size_1-of-1">
                            <div role="status" class="slds-spinner slds-spinner_medium slds-spinner_brand">
                                <span class="slds-assistive-text">{!$Label.c.Loading}</span>
                                <div class="slds-spinner__dot-a"></div>
                                <div class="slds-spinner__dot-b"></div>
                            </div>
                        </div>

                        <!-- login steps -->
                        <aura:set attribute="else">
                            <aura:if isTrue="{!v.currentStep == 0}">
                                <!-- Login Chooser -->
                                <div class="slds-col slds-m-top_small slds-size_1-of-1">
                                    <div class="slds-box">
                                        <div class="ds-login-illustration slds-m-around_medium">
                                            <div class="slds-media">
                                                <div class="slds-media__figure">
                                                    <img src="{!$Resource.LoginStep1}"/>
                                                </div>
                                                <div class="slds-media__body slds-m-left_medium slds-m-top_large">
                                                    <ul>
                                                        <li class="ds-loginToDocuSign-text">Log in to Your DocuSign
                                                            Account
                                                        </li>
                                                        <li class="slds-m-top_xx-small ds-regular-text">Disable your
                                                            browser's
                                                            pop-up blocker
                                                            before logging in.
                                                        </li>
                                                        <li class="slds-m-top_medium">
                                                            <lightning:button variant="brand" label="Log in to DocuSign"
                                                                              onclick="{!c.loginToProductionDocuSignEnvironment}"></lightning:button>
                                                        </li>
                                                        <li class="slds-m-top_large">
                                                            <ul class="slds-list_horizontal ds-bold-text">
                                                                <li>Don't have an account?</li>
                                                                <li class="slds-m-left_xxx-small">
                                                                    <a aura:id="signupLink" onclick="{!c.signUp}">Sign
                                                                        up
                                                                        for
                                                                        free.</a>
                                                                </li>
                                                            </ul>

                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <!-- Start of Advanced options -->
                                <div class="slds-col slds-m-top_small slds-size_1-of-1">
                                    <div class="{! 'slds-section' + (v.advancedOptionsExpanded ? ' slds-is-open' : '')}">
                                        <button aria-controls="advanced-options"
                                                aria-expanded="{!v.advancedOptionsExpanded}"
                                                onclick="{!c.toggleAdvancedOptions}"
                                                class="slds-button slds-section__title-action">
                                            <lightning:icon
                                                    iconName="{!v.advancedOptionsExpanded ? 'utility:chevrondown' : 'utility:chevronright'}"
                                                    size="xx-small"
                                                    alternativeText="expand advanced options"/>
                                            <span class="slds-section__title_xx-small slds-m-left_xx-small">{!$Label.c.AdvancedOptions}</span>
                                        </button>
                                        <div id="advanced-options"
                                             class="slds-section__content slds-m-top_x-small slds-m-bottom_large">
                                            <ul>
                                                <li class="ds-regular-text">
                                                    Only select an alternated DocuSign environment if you are not using
                                                    a
                                                    production
                                                    account.
                                                </li>
                                                <li class="slds-m-top_large">
                                                    <div class="slds-grid slds-grid_align-spread slds-p-bottom_large slds-border_bottom">
                                                        <div class="slds-col">
                                                            <ul>
                                                                <li class="ds-bold-text">DocuSign Demo</li>
                                                                <li class="ds-regular-text">Use this if you're using a
                                                                    DocuSign demo
                                                                    or sandbox
                                                                    account.
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <div class="slds-col">
                                                            <lightning:button variant="neutral"
                                                                              label="Log in to Demo Account"
                                                                              onclick="{!c.loginToDemoDocuSignEnvironment}"></lightning:button>
                                                        </div>
                                                    </div>
                                                </li>
                                                <li class="slds-m-top_large">
                                                    <div class="slds-grid slds-grid_align-spread">
                                                        <div class="slds-col">
                                                            <ul>
                                                                <li class="ds-bold-text">Stage or Testing Environment
                                                                </li>
                                                                <li class="ds-regular-text">Use this if you're testing
                                                                    or
                                                                    staging
                                                                    account has a
                                                                    custom URL.
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <div class="slds-col">
                                                            <ul class="slds-list_horizontal">
                                                                <li>
                                                                    <lightning:input type="text" placeholder="Type Text"
                                                                                     variant="label-hidden"
                                                                                     value="{!v.environment}"></lightning:input>
                                                                </li>
                                                                <li class="slds-m-left_small">
                                                                    <lightning:button variant="neutral"
                                                                                      label="Log in"
                                                                                      onclick="{!c.loginToOtherDocuSignEnvironment}"></lightning:button>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <!-- End of Advanced options -->
                            </aura:if>

                            <aura:if isTrue="{!v.currentStep == 1}">
                                <div class="slds-col slds-m-top_small slds-size_1-of-1">
                                    <div class="slds-box">
                                        <div class="ds-login-illustration slds-m-around_medium">
                                            <div class="slds-media">
                                                <div class="slds-media__figure">
                                                    <img src="{!$Resource.LoginStep2}"/>
                                                </div>
                                                <div class="slds-media__body slds-m-left_medium slds-m-top_large">
                                                    <ul>
                                                        <li class="ds-loginToDocuSign-text">{!$Label.c.SelectAccount}</li>
                                                        <li class="slds-m-top_xx-small ds-regular-text">
                                                            <aura:if isTrue="{!v.multipleAccountsFound}">
                                                                {!$Label.c.MultipleAccountsMessage}
                                                                <aura:set attribute="else">
                                                                    DocuSign account selected click Next to proceed to
                                                                    the
                                                                    Authorization step.
                                                                </aura:set>
                                                            </aura:if>
                                                        </li>
                                                        <li class="slds-m-top_medium ds-regular-text">
                                                            <lightning:input aura:id="accountFilter"
                                                                             variant="label-hidden"
                                                                             type="search"/>
                                                        </li>
                                                        <li class="slds-m-top_medium ds-regular-text ds-account-selection-radioGroup">
                                                            <lightning:radioGroup name="radioGroup"
                                                                                  variant="label-hidden"
                                                                                  options="{!v.accountOptions}"
                                                                                  value="{!v.selectedAccountNumber}"
                                                                                  type="radio"/>
                                                        </li>
                                                        <li class="slds-m-top_large">
                                                            <ul class="slds-list_horizontal">
                                                                <lightning:button class="slds-theme_brand"
                                                                                  variant="neutral"
                                                                                  label="Back"
                                                                                  iconName="utility:chevronleft"
                                                                                  onclick="{!c.gotoLoginStep}"/>
                                                                <lightning:button
                                                                        label="{!if(v.multipleAccountsFound, 'Select' ,'Next')}"
                                                                        variant="brand"
                                                                        class="ds-button-left-margin"
                                                                        onclick="{!c.accountSelected}"
                                                                        disabled="{!empty(v.selectedAccountNumber)}"/>
                                                            </ul>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </aura:if>

                            <aura:if isTrue="{!v.currentStep == 2}">
                                <div class="slds-col slds-p-top_small slds-size_1-of-1">
                                    <div class="slds-box">
                                        <div class="ds-login-illustration slds-m-around_medium">
                                            <div class="slds-media">
                                                <div class="slds-media__figure">
                                                    <img src="{!$Resource.LoginStep3}"/>
                                                </div>
                                                <div class="slds-media__body slds-m-left_medium slds-m-top_large">
                                                    <ul>
                                                        <li class="ds-loginToDocuSign-text">Authorize Access to
                                                            Salesforce
                                                        </li>
                                                        <aura:if isTrue="{!v.platformAuthorizationSettingsFound}">
                                                            <li class="slds-m-top_xx-small ds-regular-text">This access
                                                                allows us to
                                                                upload documents to Salesforce and attach them to
                                                                records
                                                                where your
                                                                organization needs them.
                                                            </li>
                                                            <aura:set attribute="else">
                                                                <li class="slds-m-top_xx-small ds-regular-text">
                                                                    Authorization settings are
                                                                    not present for the selected DocuSign Account. This
                                                                    option will be available once
                                                                    products that require DocuSign systems to access
                                                                    Salesforce are added on the Account.
                                                                </li>
                                                            </aura:set>
                                                        </aura:if>
                                                        <li class="slds-m-top_large">
                                                            <ul class="slds-list_horizontal">
                                                                <lightning:button class="slds-theme_brand"
                                                                                  variant="neutral"
                                                                                  label="Back"
                                                                                  iconName="utility:chevronleft"
                                                                                  onclick="{!c.gotoSelectAccountStep}"/>

                                                                <aura:if
                                                                        isTrue="{!v.platformAuthorizationSettingsFound}">
                                                                    <lightning:button label="Allow Access"
                                                                                      variant="brand"
                                                                                      class="ds-button-left-margin"
                                                                                      onclick="{!c.completePlatformOAuth}"
                                                                                      disabled="{!not(v.isLoggedIn)}"/>

                                                                    <aura:set attribute="else">
                                                                        <lightning:button label="Complete setup"
                                                                                          variant="brand"
                                                                                          class="ds-button-left-margin"
                                                                                          onclick="{!c.completeSetup}"
                                                                                          disabled="{!not(v.isLoggedIn)}"/>
                                                                    </aura:set>
                                                                </aura:if>
                                                            </ul>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </aura:if>

                        </aura:set>
                    </aura:if>
                </div>
            </div>
        </div>
    </div>
</aura:component>