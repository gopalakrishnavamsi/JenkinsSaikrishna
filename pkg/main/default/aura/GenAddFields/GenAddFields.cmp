<aura:component>
    <aura:attribute name="config" type="Object"/>
    <aura:attribute name="optionModalParams" type="Object" access="private"/>
    <aura:attribute name="clonedFieldMapping" type="Object" access="private"/>
    <aura:attribute name="mergeFieldDisplayOptions" type="Object[]" access="private"/>

    <aura:attribute name="formattedDate" type="String" access="private"/>
    <aura:attribute name="formattedCurrency" type="String" access="private"/>

    <aura:handler name="init" value="{!this}" action="{!c.init}"/>
    <aura:handler name="showOptionsModal" event="c:strike_evt" action="{!c.showOptionsModal}"/>

    <aura:method name="validate" action="{!c.validate}"/>


    <h3 class="slds-text-heading_medium slds-m-bottom_x-small">
        <strong>{!$Label.c.AddMergeFields}</strong>
    </h3>
    <h3 class="slds-text-heading_small slds-m-bottom_x-small">{!$Label.c.SalesforceFields}</h3>
    <div class="slds-m-bottom_medium slds-text-longform">
        <p>{!$Label.c.SalesforceFieldsMsg}</p>
    </div>
    <!-- Merge Data -->
    <aura:iteration items="{!v.config.objectMappings}" var="objMapping" indexVar="index">
        <c:GenTokenMapper objMapping="{!objMapping}" objIndex="{!index}"/>
    </aura:iteration>
    <!-- /Merge Data -->

    <!-- AutoPlace Fields -->
    <h3 class="slds-text-heading_small slds-m-bottom_x-small slds-m-top_large">{!$Label.c.DocusignFields}</h3>
    <div class="slds-m-bottom_medium slds-text-longform">
        <p>{!$Label.c.DocusignFieldsMsg}</p>
    </div>

    <div class="ds-repeater-box slds-box slds-box_x-small slds-theme_shade">
        <aura:if isTrue="{!v.config.signerMappings.length gt 0}">
            <div class="slds-grid slds-grid_pull-padded-large">
                <div class="slds-col slds-size_1-of-2 slds-p-horizontal_large">
                    <div class="slds-grid slds-grid_pull-padded_xxx-small">
                        <div class="slds-col slds-no-flex slds-p-horizontal_xxx-small">
                            <div class="slds-form-element__label">{!$Label.c.SignerText}</div>
                        </div>
                        <div class="slds-col slds-p-horizontal_xxx-small">
                            <div class="slds-form-element__label">{!$Label.c.FieldLabel}</div>
                        </div>
                    </div>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-horizontal_large">
                    <div class="slds-form-element__label">{!$Label.c.AnchorText}</div>
                </div>
            </div>
        </aura:if>
        <aura:iteration items="{!v.config.signerMappings}" var="signerMapping" indexVar="signerIndex">
            <div class="ds-merge-field slds-is-relative slds-m-bottom_x-small">
                <div class="slds-grid slds-grid_align-spread slds-grid_pull-padded-large slds-is-relative">
                    <div class="slds-col slds-p-horizontal_large">
                        <div class="slds-form-element ds-readonly">
                            <div class="slds-form-element__control">
                                <div class="slds-input">{!signerIndex + 1}</div>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-p-horizontal_large">
                        <lightning:buttonMenu menuAlignment="right" onselect="{!c.removeSigner}" value="{!signerIndex}"
                                              variant="border-filled">
                            <lightning:menuItem
                                    label="{!$Label.c.Remove}"/>
                        </lightning:buttonMenu>
                    </div>
                </div>

                <aura:iteration items="{!signerMapping.fieldMappings}" var="fieldMapping" indexVar="index">
                    <c:GenSignerFieldPicker aura:id="fieldMapping" fieldMapping="{!fieldMapping}"
                                            parentIndex="{!signerIndex}" index="{!index}"
                                            removeSignerField="{!c.removeSignerField}"/>
                </aura:iteration>

                <div class="slds-m-bottom_x-small slds-p-left_xx-large">
                    <lightning:button iconName="utility:add" label="{!$Label.c.Add}" value="{!signerIndex}"
                                      onclick="{!c.addSignerField}"/>
                </div>
            </div>
        </aura:iteration>

        <aura:if isTrue="{!v.config.signerMappings.length lt 4}">
            <lightning:button iconName="utility:add" label="{!$Label.c.AddSigner}" onclick="{!c.addSigner}"/>
        </aura:if>
    </div>
    <!-- /AutoPlace Fields -->

    <!-- Merge Field Options Modal -->
    <c:strike_modal aura:id="merge-token-options" title="{!$Label.c.MergeFieldOptions}"
                    primaryButtonLabel="{!$Label.c.save}" strike_evt_modalPrimaryButtonClicked="{!c.saveOptions}">
        <aura:if isTrue="{!or(v.clonedFieldMapping.dataType == 'DATE', v.clonedFieldMapping.dataType == 'DATETIME')}">
            <div class="slds-grid slds-gutters_x-small">
                <div class="slds-col slds-size_1-of-2">
                    <lightning:select label="{!$Label.c.DateFormat}" onchange="{!c.formatDate}"
                                      value="{!v.clonedFieldMapping.dateFormat}">
                        <option value="default">{!$Label.c.LocaleDefault}</option>
                        <option value="MM/dd/yyyy">MM/DD/YYYY</option>
                        <option value="yyyy-MM-dd">YYYY-MM-DD</option>
                        <option value="dd.MM.yyyy">DD.MM.YYYY</option>
                        <option value="MMMM dd, yyyy">Month Day, Year</option>
                    </lightning:select>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <div class="slds-form-element ds-readonly">
                        <div class="slds-form-element__label">{!$Label.c.DatePreview}</div>
                        <div class="slds-form-element__control">
                            <div class="slds-input">{!v.formattedDate}</div>
                        </div>
                    </div>
                </div>
            </div>
        </aura:if>
        <aura:if isTrue="{!v.clonedFieldMapping.dataType == 'CURRENCY'}">
            <div class="slds-grid slds-gutters_x-small slds-m-top_small">
                <div class="slds-col slds-size_1-of-2">
                    <lightning:select label="{!$Label.c.CurrencyFormat}" value="{!v.clonedFieldMapping.currencyFormat}"
                                      onchange="{!c.formatCurrency}">
                        <option value="symbol">{!$Label.c.DisplayAsSymbol}</option>
                        <option value="symbolNoDecimals">{!$Label.c.DisplaySymbolNoDecimals}</option>
                        <option value="code">{!$Label.c.DisplayAsISO}</option>
                        <option value="codeNoDecimals">{!$Label.c.DisplayAsISONoDecimals}</option>
                    </lightning:select>
                </div>
                <div class="slds-col slds-size_1-of-2">
                    <div class="slds-form-element ds-readonly">
                        <div class="slds-form-element__label">{!$Label.c.CurrencyPreview}</div>
                        <div class="slds-form-element__control">
                            <div class="slds-input">
                                {!v.formattedCurrency}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </aura:if>

        <div class="slds-m-top_small">
            <lightning:radioGroup name="mergeFieldDisplayOption" label="{!$Label.c.DisplaysOptions}"
                                  options="{!v.mergeFieldDisplayOptions}" type="radio"
                                  value="{!v.clonedFieldMapping.isConditional}" class="slds-m-top_small"
                                  onchange="{!c.convertToBoolean}"/>

            <aura:if isTrue="{!v.clonedFieldMapping.isConditional}">
                <div class="slds-m-top_x-small slds-m-left_large slds-border_left slds-p-left_small">

                    <p>{!$Label.c.DisplaysOptionsMsg}</p>

                    <div class="slds-show_inline-block ds-align-top">
                        <lightning:select class="ds-no-label" value="{!v.clonedFieldMapping.matchType}">
                            <option value="Match">{!$Label.c.MatchesLabel}</option>
                            <option value="NotMatch">{!$Label.c.DoesNotMatch}</option>
                        </lightning:select>
                    </div>

                    <div class="slds-show_inline-block slds-m-left_x-small">
                        <lightning:input aura:id="conditionalValue" type="text" label="{!$Label.c.value}"
                                         class="ds-no-label" required="true"
                                         placeholder="{!$Label.c.ExampleCalifornia}"
                                         value="{!v.clonedFieldMapping.conditionalValue}"/>
                    </div>
                </div>
            </aura:if>
        </div>
    </c:strike_modal>
    <!-- /Merge Field Options Modal -->
</aura:component>