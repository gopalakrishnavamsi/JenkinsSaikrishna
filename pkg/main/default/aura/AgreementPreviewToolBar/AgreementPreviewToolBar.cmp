<aura:component controller="AgreementsController">
    <ltng:require scripts="{!$Resource.navUtils}"/>
    <aura:attribute name="agreement" type="Agreement" access="public"/>
    <aura:attribute name="sourceId" type="Id" access="public"/>
    <aura:attribute name="agreementActionManager" type="Object" access="public"/>
    <aura:attribute name="uiHelper" type="Object" access="public"/>
    <aura:attribute name="isAgreementDeleted" type="Boolean" access="public"/>
    <aura:attribute name="isESignatureEnabled" type="Boolean" default="false"/>
    <aura:attribute name="AgreementStatusTypes" type="Object"/>

    <aura:handler name="init" value="{!this}" action="{!c.initializeResources}"/>

    <div class="toolBarContainer">
        <div class="slds-grid slds-grid_align-spread">
            <div class="slds-col">
                <ul class="slds-list_horizontal">
                    <li>
                        <div class="mainLogo slds-p-around_small">
                            <img class="logo" src="{!$Resource.DocuSignLogoWhite}" alt="Logo"/>
                        </div>
                    </li>
                    <li>
                        <div class="headerDivider slds-m-top_small"></div>
                    </li>
                    <li>
                        <div class="slds-text-body_regular slds-p-around_medium">{!v.agreement.name}</div>
                    </li>
                </ul>
            </div>
            <div class="slds-col slds-p-around_small">
                <lightning:button label="{!$Label.c.Back}" title="{!$Label.c.Back}" onclick="{!c.backToSourceRecord}"/>
                <lightning:buttonMenu aura:id="editMenu" iconName="utility:edit"
                                      class="slds-p-left_xx-small"
                                      menuAlignment="right">
                    <lightning:menuItem label="{!$Label.c.Download}" value="{!$Label.c.Download}"
                                        onactive="{!c.download}"/>
                    <aura:if isTrue="{!v.agreement.versions.length > 0}">
                        <lightning:menuItem label="{!$Label.c.DownloadWithRedlines}"
                                            value="{!$Label.c.DownloadWithRedlines}"
                                            disabled="{!or(v.agreement.extension != 'docx', v.agreement.versions[0].extension != 'docx')}"
                                            onactive="{!c.downloadWithRedlines}"/>
                    </aura:if>
                    <lightning:menuItem label="{!$Label.c.AddToSalesforce}" value="{!$Label.c.AddToSalesforce}"
                                        onactive="{!c.addToSalesforce}"/>
                    <lightning:menuItem label="{!$Label.c.UploadNewVersion}"
                                        value="{!$Label.c.UploadNewVersion}"
                                        onactive="{!c.upload}"
                                        disabled="{!v.agreement.status == v.AgreementStatusTypes.COMPLETED
                                                   || v.agreement.status == v.AgreementStatusTypes.PENDING_REVIEW
                                                   || v.agreement.status == v.AgreementStatusTypes.PENDING_APPROVAL}"/>
                    <lightning:menuItem label="{!$Label.c.Rename}" value="{!$Label.c.Rename}"
                                        onactive="{!c.rename}"
                                        disabled="{!v.agreement.status == v.AgreementStatusTypes.PENDING_REVIEW
                                                   || v.agreement.status == v.AgreementStatusTypes.PENDING_APPROVAL
                                                   || v.agreement.status == v.AgreementStatusTypes.PENDING_SIGNATURE}"/>
                    <lightning:menuItem label="{!$Label.c.DeleteButtonLabel}"
                                        value="{!$Label.c.DeleteButtonLabel}"
                                        onactive="{!c.delete}"
                                        disabled="{!v.agreement.status == v.AgreementStatusTypes.PENDING_REVIEW
                                                  || v.agreement.status == v.AgreementStatusTypes.PENDING_APPROVAL
                                                  || v.agreement.status == v.AgreementStatusTypes.PENDING_SIGNATURE}"/>
                </lightning:buttonMenu>
                <lightning:buttonMenu aura:id="shareMenu" iconName="utility:internal_share"
                                      class="slds-p-left_xx-small" menuAlignment="right">
                    <lightning:menuItem label="{!$Label.c.agreementsShareLink}"
                                        value="{!$Label.c.agreementsShareLink}" onactive="{!c.share}"/>
                    <lightning:menuItem aura:id="ExternalReview"
                                        label="{!$Label.c.agreementsExternalReview}"
                                        value="{!$Label.c.agreementsExternalReview}"
                                        onactive="{!c.externalReview}"
                                        disabled="{!v.agreement.status == v.AgreementStatusTypes.PENDING_REVIEW
                                                   || v.agreement.status == v.AgreementStatusTypes.PENDING_APPROVAL
                                                   || v.agreement.status == v.AgreementStatusTypes.PENDING_SIGNATURE
                                                   || v.agreement.status == v.AgreementStatusTypes.COMPLETED}"/>
                    <lightning:menuItem label="{!$Label.c.agreementsInternalApproval}"
                                        value="{!$Label.c.agreementsInternalApproval}"
                                        onactive="{!c.internalApproval}"
                                        disabled="{!v.agreement.status == v.AgreementStatusTypes.PENDING_REVIEW
                                                   || v.agreement.status == v.AgreementStatusTypes.PENDING_APPROVAL
                                                   || v.agreement.status == v.AgreementStatusTypes.PENDING_SIGNATURE
                                                   || v.agreement.status == v.AgreementStatusTypes.COMPLETED}"/>
                    <lightning:menuItem label="{!$Label.c.SendForSignature}"
                                        value="{!$Label.c.SendForSignature}"
                                        onactive="{!c.sendForSignature}"
                                        disabled="{!v.agreement.status == v.AgreementStatusTypes.PENDING_REVIEW
                                               || v.agreement.status == v.AgreementStatusTypes.PENDING_APPROVAL
                                               || v.agreement.status == v.AgreementStatusTypes.PENDING_SIGNATURE}"
                                        class="{!if(!v.isESignatureEnabled,'slds-hide','')}"/>
                </lightning:buttonMenu>
            </div>
        </div>
    </div>
    <div aura:id="modalContent"/>
</aura:component>