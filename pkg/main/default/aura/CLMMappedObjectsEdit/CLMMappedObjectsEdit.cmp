<aura:component extends="c:CLMUtility" controller="CLMMapObjectController">
	<ltng:require scripts="{!$Resource.stringUtils}" />
	<!--component dependency-->

	<aura:dependency resource="markup://c:CLMModelFooterButton" type="COMPONENT" />
	<aura:dependency resource="markup://c:CLMMappingObjectNaming" type="COMPONENT" />
	<aura:dependency resource="markup://c:CLMFolderExample" type="COMPONENT" />
	<aura:dependency resource="markup://c:CLMSelectingFields" type="COMPONENT" />

	<!--event fire-->
	<aura:registerEvent name="CLMNavigationEvent" type="c:CLMNavigationEvent" />
	<aura:registerEvent name="CLMBreadcrumbsEvent" type="c:CLMBreadcrumbsEvent" />
	<aura:registerEvent name="CLMPathEvent" type="c:CLMPathEvent" />
	<aura:registerEvent name="CLMEvent" type="c:CLMEvent" />
	<aura:registerEvent name="CLMModelFooterButtonPrimaryBtn_disable" type="c:strike_evt" />
	<aura:registerEvent name="CLMModelFooterButtonPrimaryBtn_enable" type="c:strike_evt" />
	<!--event handler-->
	<aura:handler name="init" value="{!this}" action="{!c.onInit}" />


	<aura:handler event="c:CLMPathEvent" action="{!c.updateFromPathUI}" />
	<aura:handler name="strike_evt_modalPrimaryButtonClicked" event="c:strike_evt" action="{!c.handleConfirm}" />
	<aura:handler name="strike_evt_modalSecondaryButtonClicked" event="c:strike_evt" action="{!c.closeModal}" />
	<aura:handler name="strike_evt_modalCloseButtonClicked" event="c:strike_evt" action="{!c.closeModal}" />
	<aura:handler name="CLMMappingObjectEvent_UpdateName" event="c:CLMMappingObjectEvent"
		action="{!c.updateTextFromModel}" />
	<!--place holder attributes-->
	<aura:attribute name="title" type="String" default="{!$Label.c.MapEditObjectsTitle}" />
	<aura:attribute name="titleHelpText" type="String" default="{!$Label.c.MapEditObjectsTitleHelpText}" />
	<aura:attribute name="currentStep" type="String" default="1" />
	<aura:attribute name="isEdit" type="Boolean" default="false" />

	<aura:attribute name="selectedObjDetails" type="Object" />
	<!--internal attributes-->
	<aura:attribute name="allObjects" type="List" access="private" />
	<aura:attribute name="allObjectsList" type="List" access="private" />

	<aura:attribute name="allObjectFields" type="List" access="private" />
	<aura:attribute name="allObjectFieldsList" type="List" access="private" />

	<aura:attribute name="selectedObjFieldName" default="" type="String" access="private" />

	<aura:attribute name="selectedFolderParentExample" type="String" default="Other Sources" access="private" />
	<aura:attribute name="SelectedFolderExample" default="Salesforce" type="String" access="private" />

	<aura:attribute name="clmFolderTree" type="List" access="private" />
	<aura:attribute name="pathInCLM" default="" type="String" access="private" />

	<aura:attribute name="isAddSubFolder" type="Boolean" default="true" access="private" />
	<aura:attribute name="isRenameFolder" type="Boolean" default="true" access="private" />
	<aura:attribute name="isDeleteFolder" type="Boolean" default="true" access="private" />
	<aura:attribute name="loader" type="Boolean" default="false" access="private" />

	<!--modal attributes-->
	<aura:attribute name="modalValueHolder" type="Object" access="private" />
	<aura:attribute name="modalTitleText" type="String" access="private" />
	<aura:attribute name="modalBody" type="Aura.Component[]" default="" />
	<aura:attribute name="modalSecondaryButtonText" type="String" access="private" />
	<aura:attribute name="modalPrimaryButtonText" type="String" access="private" />
	<aura:attribute name="showModal" type="Boolean" default="false" access="private" />
	<aura:attribute name="isRemove" type="Boolean" default="false" access="private" />
	<aura:attribute name="strikeModelFooterButtons" type="Aura.Component[]" />
	<aura:attribute name="modalBodyText" type="String" default="" />

	<!--child components-->
	<aura:if isTrue="{!v.showModal}">
		<c:strike_modal aura:id="popupModel" footerButtons="{!v.strikeModelFooterButtons}"
			body="{!v.modalBodyText ? v.modalBodyText : v.modalBody}" title="{!v.modalTitleText}" size="large"
			primaryButtonLabel="{!v.modalPrimaryButtonText}" secondaryButtonLabel="{!v.modalSecondaryButtonText}" />
	</aura:if>

	<div class="slds-card__body slds-is-relative slds-p-left_x-large slds-p-right_x-large">
		<aura:if isTrue="{!v.loader}">
			<lightning:spinner alternativeText="{!$Label.c.Loading}" size="large" />
		</aura:if>
		<div class="slds-border_top">
			<lightning:layout multipleRows="true">
				<lightning:layoutItem size="12">
					<div class="slds-p-top_medium slds-p-bottom_small ">
						<span class="medium-fonts-size blue-text-color">
							<b>{!v.title} </b>
						</span>
						<span>
							<lightning:helptext content="{!v.titleHelpText}" />
						</span>
					</div>
				</lightning:layoutItem>
				<lightning:layoutItem size="12">
					<div class="slds-p-top_x-small slds-p-bottom_small">
						<aura:if isTrue="{!v.currentStep=='1'}">
							<div onkeyup="{! c.handleSearchObject }">
								<lightning:input aura:id="search-object" placeholder="{!$Label.c.SearchObject}"
									type="search" variant="label-hidden" />
							</div>
						</aura:if>
						<aura:if isTrue="{!v.currentStep=='2'}">
							<lightning:input onchange="{!c.validateFieldSelection}" name="fileName"
								label="{!$Label.c.SelectFieldToNameTheFolder}" value="{!v.selectedObjFieldName}" />
							<div class="slds-grid">
								<div>
									<lightning:button variant="base" label="{!$Label.c.WhyAmISelectingFields}"
										title="{!$Label.c.WhyAmISelectingFields}" onclick="{!c.openWhyExample}" />
								</div>
								<aura:if isTrue="{!if(empty(v.selectedObjFieldName),'false','true')}">
									<div class="slds-col_bump-left">
										<lightning:button variant="base" label="{!$Label.c.SeeExample}"
											title="{!$Label.c.SeeExample}" onclick="{!c.openSeeExample}" />
									</div>
								</aura:if>
							</div>
						</aura:if>
						<aura:if isTrue="{!v.currentStep=='3'}">
							<b>{!$Label.c.PathInDocuSignCLM}:</b><span
								class="slds-p-left_medium blue-text-color"><strong>{!$Label.c.OtherSources}{!v.pathInCLM}</strong></span>
						</aura:if>
					</div>
				</lightning:layoutItem>
				<lightning:layoutItem size="12">
					<div class="slds-p-top_small slds-p-bottom_small ">
						<aura:if isTrue="{!v.currentStep=='2'}">
							<div onkeyup="{! c.handleSearchField }">
								<lightning:input aura:id="search-field" placeholder="{!$Label.c.SearchFields}"
									type="search" variant="label-hidden" />
							</div>
						</aura:if>
						<aura:if isTrue="{!v.currentStep=='3'}">
							<div class="slds-grid slds-m-around_x-small ">
								<div class="slds-col_bump-left">
									<lightning:button label="{!$Label.c.AddSubfolder}" onclick="{!c.addSubFolder}"
										iconName="utility:add" iconPosition="right" disabled="{!v.isAddSubFolder}" />
									<lightning:button label="{!$Label.c.Rename}" onclick="{!c.renameSubFolder}"
										iconName="utility:edit" iconPosition="right" disabled="{!v.isRenameFolder}" />
									<lightning:button label="{!$Label.c.DeleteButtonLabel}"
										onclick="{!c.deleteSubFolder}" iconName="utility:delete" iconPosition="right"
										class="slds-button_text-destructive" disabled="{!v.isDeleteFolder}" />
								</div>
							</div>
						</aura:if>
						<div class="slds-scrollable_y" style="max-height:500px">
							<aura:if isTrue="{!v.currentStep=='1'}">
								<ul class="slds-tree" role="tree">
									<aura:iteration items="{!v.allObjectsList}" var="data">
										<li aria-level="1" id="{!data.name}" role="treeitem"
											tabindex="{! data.selected ? '0':'-1'}" onclick="{!c.onObjSelection}">
											<div
												class="{! data.selected ? 'ds-blue-icon slds-tree__item':'slds-tree__item'}">
												<lightning:icon size="x-small"
													iconName="{! data.selected ? 'utility:check':'utility:open_folder'}"
													alternativeText="{!$Label.c.OpenFolder}" />
												<span class="slds-p-left_small slds-has-flexi-truncate">
													{!data.label}
												</span>
											</div>
										</li>
									</aura:iteration>
								</ul>
							</aura:if>
							<aura:if isTrue="{!v.currentStep=='2'}">
								<div class="slds-box slds-p-around_none">
									<ul class="slds-tree" role="tree">
										<aura:iteration items="{!v.allObjectFieldsList}" var="objectData">
											<li aria-expanded="{!objectData.selected}" aria-level="1"
												id="{!objectData.name}" role="treeitem"
												onclick="{!c.onObjFolderSelection}">
												<div class="slds-tree__item">
													<lightning:icon size="x-small" class="slds-p-left_xx-small"
														iconName="{!objectData.selected?'utility:down':'utility:right'}"
														alternativeText="{!$Label.c.OpenFolder}" />
													<lightning:icon size="x-small" class="slds-p-left_xx-small"
														iconName="utility:open_folder"
														alternativeText="{!$Label.c.OpenFolder}" />
													<span
														class="slds-p-left_x-small slds-tree__item-label slds-has-flexi-truncate">
														{!objectData.label}
													</span>
												</div>
												<ul role="group" class="slds-p-left_medium">
													<aura:iteration items="{!objectData.fields}" var="fieldData">
														<li data-obj="{!if(objectData.relationship != undefined, objectData.relationship, objectData.name)}"
															class="ds-parent-hover" aria-level="2"
															id="{!fieldData.name}" role="treeitem"
															onclick="{!c.onObjFieldSelection}">
															<div class="slds-grid slds-tree__item">
																<lightning:icon size="x-small"
																	class="slds-p-left_xx-small"
																	iconName="utility:topic2"
																	alternativeText="{!$Label.c.OpenFolder}" />
																<span
																	class="slds-p-left_x-small slds-tree__item-label slds-has-flexi-truncate">
																	{!fieldData.label}
																</span>
																<div
																	class="slds-col_bump-left ds-hover slds-p-right_small">
																	<lightning:button variant="base"
																		class="ds-no-extra-height"
																		label="{!$Label.c.ClickToAdd}"
																		title="{!$Label.c.ClickToAdd}" />
																</div>
															</div>
														</li>
													</aura:iteration>
												</ul>
											</li>
										</aura:iteration>
									</ul>
								</div>
							</aura:if>
							<aura:if isTrue="{!v.currentStep=='3'}">
								<div class="slds-grid">
									<div class="slds-col slds-size_1-of-2 slds-box slds-p-around_none">
										<div class="slds-p-around_medium slds-border_bottom">
											{!$Label.c.YourDocuSignCLMFolders}
										</div>
										<ul class="slds-tree slds-p-around_medium" role="tree">
											<aura:iteration items="{!v.clmFolderTree}" var="tree">
												<li aria-expanded="true" aria-level="{!tree.level}"
													class="{!tree.selected?'ds-gray-background':''}"
													tabindex="{!tree.selected?'0':'-1'}" data-id="{!tree.id}"
													data-value="{!tree.type}" onclick="{!c.onCLMFolderSelection}">
													<div
														class="{!tree.level==1?'ds-gray-folder slds-tree__item':tree.type=='tail'?'ds-blue-folder slds-tree__item':'ds-yellow-folder slds-tree__item'}">
														<lightning:icon size="x-small" class="slds-p-right_xx-small"
															iconName="utility:open_folder"
															alternativeText="{!$Label.c.OpenFolder}" />
														<span title="{!tree.name}" class=" slds-has-flexi-truncate">
															{!tree.name}
														</span>
													</div>
												</li>
											</aura:iteration>
										</ul>
									</div>
									<div class="slds-col slds-size_1-of-2 slds-box slds-p-around_none ">
										<div class="slds-p-around_medium slds-border_bottom">
											{!v.selectedFolderParentExample}&nbsp;{!$Label.c.FolderContents}
										</div>
										<ul class="slds-tree slds-p-around_medium" role="tree">
											<li class="slds-p-bottom_x-small" aria-expanded="true" aria-level="1"
												id="{!v.SelectedFolderExample}" role="treeitem" tabindex="0">
												<lightning:icon size="x-small" class="slds-p-left_xx-small"
													iconName="utility:open_folder"
													alternativeText="{!$Label.c.OpenFolder}" />
												<span title="{!$Label.c.OtherSources}"
													class="slds-p-bottom_small slds-p-left_x-small slds-has-flexi-truncate">
													{!v.SelectedFolderExample} Object 1
												</span>
											</li>
											<li class="slds-p-bottom_x-small" aria-expanded="true" aria-level="1"
												id="{!v.SelectedFolderExample}" role="treeitem" tabindex="0">
												<lightning:icon size="x-small" class="slds-p-left_xx-small"
													iconName="utility:open_folder"
													alternativeText="{!$Label.c.OpenFolder}" />
												<span
													class="slds-p-bottom_small slds-p-left_x-small slds-has-flexi-truncate">
													<img src="{!($Resource.CLMChooseLocationBar)}"
														alt="{!$Label.c.ExampleFolderImage}" />
												</span>
											</li>
											<li class="slds-p-bottom_x-small" aria-expanded="true" aria-level="1"
												id="{!v.SelectedFolderExample}" role="treeitem" tabindex="0">
												<lightning:icon size="x-small" class="slds-p-left_xx-small"
													iconName="utility:open_folder"
													alternativeText="{!$Label.c.OpenFolder}" />
												<span
													class="slds-p-bottom_small slds-p-left_x-small slds-has-flexi-truncate">
													<img src="{!($Resource.CLMChooseLocationBar)}"
														alt="{!$Label.c.ExampleFolderImage}" />
												</span>
											</li>
										</ul>
										<ul class="slds-tree slds-p-around_medium" role="tree">
											<li aria-expanded="true" class="slds-grid" aria-level="1" role="treeitem"
												tabindex="0">
												<div class="ds-blue-folder">
													<lightning:icon size="x-small" class="slds-p-left_xx-small"
														iconName="utility:info"
														alternativeText="{!$Label.c.OpenFolder}" />
												</div>
												<div>
													<span title="{!$Label.c.OtherSources}"
														class="slds-p-bottom_small slds-p-left_x-small slds-has-flexi-truncate">
														{!$Label.c.CaseFolderContentsHelp}
													</span>
												</div>
											</li>
										</ul>
									</div>
								</div>
							</aura:if>
						</div>
					</div>
				</lightning:layoutItem>
			</lightning:layout>
		</div>
	</div>
	<footer class="slds-modal__footer">
		<aura:if isTrue="{!v.currentStep=='1'}">
			<lightning:button label="{!$Label.c.Cancel}" title="{!$Label.c.Cancel}" onclick="{! c.back }" />
			<lightning:button variant="brand" label="{!$Label.c.Next}" title="{!$Label.c.Next}"
				onclick="{! c.gotNextStep }" disabled="{!!v.selectedObjDetails}" />
		</aura:if>
		<aura:if isTrue="{!v.currentStep=='2'}">
			<aura:if isTrue="{!v.isEdit}">
				<lightning:button label="{!$Label.c.Cancel}" title="{!$Label.c.Cancel}" onclick="{! c.back }" />
				<aura:set attribute="else">
					<lightning:button label="{!$Label.c.Back}" title="{!$Label.c.Back}" onclick="{! c.back }" />
				</aura:set>
			</aura:if>
			<lightning:button variant="brand" label="{!$Label.c.Next}" title="{!$Label.c.Next}"
				onclick="{! c.gotNextStep }" disabled="{!if(empty(v.selectedObjFieldName),'true','false')}" />
		</aura:if>
		<aura:if isTrue="{!v.currentStep=='3'}">
			<lightning:button label="{!$Label.c.Back}" title="{!$Label.c.Back}" onclick="{! c.back }" />
			<lightning:button variant="brand" label="{!$Label.c.Confirm}" title="{!$Label.c.Confirm}"
				onclick="{!c.insertPath}" />
		</aura:if>
	</footer>
</aura:component>