<aura:component description="AgreementsImport" controller="AgreementsController">
    <!-- FIXME : Check the resource.Utiljs since it has been refactored -->
    <!-- FIXME : Check hardcoding and replace with labels  -->
    <ltng:require scripts="{!$Resource.stringUtils}"/>
    <!-- attributes -->
    <aura:attribute name="loading" type="Boolean" access="private"/>
    <aura:attribute name="showModal" type="Boolean" default="{!false}"/>
    <aura:attribute name="agreementDetails" type="Agreement"/>
    <aura:attribute name="currentStep" type="String"/>
    <aura:attribute name="recordId" type="Id" />
    <aura:attribute name="salesforceFiles" type="Object[]" access="private"/>
    <aura:attribute name="importedFile" type="Object" access="private"/>
    <aura:attribute name="disableSalesforceFileImport" type="Boolean" default="true" access="private"/>
    <aura:attribute name="widget" type="Object" access="private"/>
    <aura:attribute name="entityId" type="Object" access="private"/>

    <aura:handler name="strike_evt_modalCloseButtonClicked" event="c:strike_evt" action="{!c.cancelButtonClicked}"/>
    <ltng:require styles="{!$Resource.scmwidgetscss}" scripts="{!$Resource.scmwidgetsjs}" afterScriptsLoaded="{!c.uploadScriptsLoaded}" />

    <!-- Events -->
    <aura:handler name="init" value="{!this}" action="{!c.onInit}"/>
    <aura:registerEvent name="toastEvent" type="c:ToastEvent"/>
    <aura:registerEvent name="loadingEvent" type="c:LoadingEvent"/>

    <c:strike_modal aura:id="importAgreementsModal"
                    title="{!if(v.currentStep == '1', 'Import Files')
                            +if(v.currentStep == '2', 'Select a File')
                            +if(v.currentStep == '3', 'Upload a File')
                            +if(v.currentStep == '4', 'New Agreement Created')}"
                    showModal="{!v.showModal}"
                    showFooter="{!if(v.currentStep == '1', false,true)}"
                    successHeader="{!if(v.currentStep == '4', true,false)}">

        <aura:if isTrue="{!v.loading}">
            <div class="slds-is-static">
                <div role="status" class="slds-spinner slds-spinner_medium slds-spinner_brand">
                    <span class="slds-assistive-text">{!$Label.c.Loading}</span>
                    <div class="slds-spinner__dot-a"></div>
                    <div class="slds-spinner__dot-b"></div>
                </div>
            </div>
        </aura:if>

        <div class="{!'slds-scope slds-p-horizontal--xx-large' + if(v.loading, ' ds-fadeBackground')}">
            <div class="slds-grid slds-grid_vertical">
                <aura:if isTrue="{!v.currentStep == '1'}">
                    <div class="slds-col">
                        <div class="slds-text-align--center">
                            Start by choosing a source to import your files from.
                        </div>
                    </div>
                    <div class="slds-col slds-p-top_medium">
                        <div class="slds-grid slds-gutters_small slds-grid_vertical">
                            <div class="slds-col">
                                <a onclick="{!c.navigateToFileSelection}"
                                   class="slds-box slds-box_link slds-box_x-small slds-media">
                                    <div class="slds-media__figure slds-media__figure_fixed-width slds-align_absolute-center slds-m-left_xx-small">
                                        <span class="slds-icon slds-icon_medium">
                                            <img src="{!$Resource.import_file}"/>
                                        </span>
                                    </div>
                                    <div class="slds-media__body slds-border_left slds-p-around_small">
                                        <h2 class="slds-truncate ds-visualPickerHeading"
                                            title="Choose from Salesforce Files">
                                            Choose from Salesforce Files</h2>
                                        <p class="slds-m-top_small">Select with one of the files associated with this record.</p>
                                    </div>
                                </a>
                            </div>
                            <div class="slds-col slds-p-top_medium slds-p-bottom_medium">
                                <a onclick="{!c.navigateToUploadFilesfromPC}"
                                   class="slds-box slds-box_link slds-box_x-small slds-media">
                                    <div class="slds-media__figure slds-media__figure_fixed-width slds-align_absolute-center slds-m-left_xx-small">
                                        <span class="slds-icon slds-icon_medium">
                                            <img src="{!$Resource.import_upload}"/>
                                        </span>
                                    </div>
                                    <div class="slds-media__body slds-border_left slds-p-around_small">
                                        <h2 class="slds-truncate visualPickerHeading"
                                            title="Upload from PC">
                                            Upload from PC</h2>
                                        <p class="slds-m-top_small">
                                            Upload a document directly from computer.</p>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </aura:if>

                <aura:if isTrue="{!v.currentStep == '2'}">
                    <div class="slds-col slds-p-horizontal_large">
                        <div class=" slds-text-align_center">
                            Choose one of the files available from this Salesforce record.
                        </div>
                        <ul class="slds-p-top_small">
                        <aura:iteration items="{!v.salesforceFiles}" var="file" indexVar="fileIndex">
                            <li class="slds-item slds-p-vertical_small">
                                <article class="slds-tile slds-media slds-media_center">
                                    <div class="slds-media__figure">
                                        <lightning:input type="checkbox" aura:id="file-checkbox" label="Select"
                                                         onchange="{!c.handleFileSelection}" checked="{!file.selected}"
                                                         class="ds-no-label" value="{!file.sourceId}"
                                                         disabled="{!v.loading}"/>
                                    </div>
                                    <div class="slds-media__figure">
                                        <!-- File Icon -->
                                        <lightning:icon iconName="{!
                                            'doctype:'
                                            + if(file.extension == 'doc', 'word')
                                            + if(file.extension == 'docm', 'gdoc')
                                            + if(file.extension == 'docx', 'word')
                                            + if(file.extension == 'dot', 'gdoc')
                                            + if(file.extension == 'dotm', 'gdoc')
                                            + if(file.extension == 'dotx', 'gdoc')
                                            + if(file.extension == 'htm', 'html')
                                            + if(file.extension == 'html', 'html')
                                            + if(file.extension == 'msg', 'unknown')
                                            + if(file.extension == 'pdf', 'pdf')
                                            + if(file.extension == 'rtf', 'gdoc')
                                            + if(file.extension == 'txt', 'gdoc')
                                            + if(file.extension == 'wpd', 'gdoc')
                                            + if(file.extension == 'xps', 'unknown')
                                            + if(file.extension == 'bmp', 'image')
                                            + if(file.extension == 'gif', 'image')
                                            + if(file.extension == 'jpg', 'image')
                                            + if(file.extension == 'jpeg', 'image')
                                            + if(file.extension == 'png', 'image')
                                            + if(file.extension == 'tif', 'image')
                                            + if(file.extension == 'tiff', 'image')
                                            + if(file.extension == 'pot', 'slide')
                                            + if(file.extension == 'potx', 'slide')
                                            + if(file.extension == 'pps', 'slide')
                                            + if(file.extension == 'ppt', 'slide')
                                            + if(file.extension == 'pptm', 'slide')
                                            + if(file.extension == 'pptx', 'slide')
                                            + if(file.extension == 'csv', 'gsheet')
                                            + if(file.extension == 'xls', 'gsheet')
                                            + if(file.extension == 'xlsm', 'gsheet')
                                            + if(file.extension == 'xlsx', 'gsheet')
                                        }"/>
                                        <!-- /File Icon -->
                                    </div>
                                    <div class="slds-media__body">
                                        <h3 class="slds-truncate ds-fileDetails" title="{!file.name}">
                                            {!file.name}
                                        </h3>
                                        <div class="slds-truncate slds-text-color_weak fileDetails">
                                            {!file.formattedSize} • {!file.extension}</div>
                                    </div>
                                </article>
                            </li>
                            <div class="ds-fileSpacing"/>
                        </aura:iteration>
                        </ul>
                    </div>
                </aura:if>

                <aura:if isTrue="{!v.currentStep == '4'}">
                    <div class="slds-col">
                        <div class="slds-text-align--center">
                            The file below has been copied from Salesforce files, imported to DocuSign Agreements, and
                            now can be sent for negotiation, approval or signature.
                        </div>
                    </div>

                    <div class="slds-col slds-p-top_medium">
                        <article class="slds-tile slds-media slds-media_center">
                            <div class="slds-media__figure">
                                <!-- File Icon -->
                                <lightning:icon iconName="{!
                                            'doctype:'
                                            + if(v.importedFile.extension == 'doc', 'word')
                                            + if(v.importedFile.extension == 'docm', 'gdoc')
                                            + if(v.importedFile.extension == 'docx', 'word')
                                            + if(v.importedFile.extension == 'dot', 'gdoc')
                                            + if(v.importedFile.extension == 'dotm', 'gdoc')
                                            + if(v.importedFile.extension == 'dotx', 'gdoc')
                                            + if(v.importedFile.extension == 'htm', 'html')
                                            + if(v.importedFile.extension == 'html', 'html')
                                            + if(v.importedFile.extension == 'msg', 'unknown')
                                            + if(v.importedFile.extension == 'pdf', 'pdf')
                                            + if(v.importedFile.extension == 'rtf', 'gdoc')
                                            + if(v.importedFile.extension == 'txt', 'gdoc')
                                            + if(v.importedFile.extension == 'wpd', 'gdoc')
                                            + if(v.importedFile.extension == 'xps', 'unknown')
                                            + if(v.importedFile.extension == 'bmp', 'image')
                                            + if(v.importedFile.extension == 'gif', 'image')
                                            + if(v.importedFile.extension == 'jpg', 'image')
                                            + if(v.importedFile.extension == 'jpeg', 'image')
                                            + if(v.importedFile.extension == 'png', 'image')
                                            + if(v.importedFile.extension == 'tif', 'image')
                                            + if(v.importedFile.extension == 'tiff', 'image')
                                            + if(v.importedFile.extension == 'pot', 'slide')
                                            + if(v.importedFile.extension == 'potx', 'slide')
                                            + if(v.importedFile.extension == 'pps', 'slide')
                                            + if(v.importedFile.extension == 'ppt', 'slide')
                                            + if(v.importedFile.extension == 'pptm', 'slide')
                                            + if(v.importedFile.extension == 'pptx', 'slide')
                                            + if(v.importedFile.extension == 'csv', 'gsheet')
                                            + if(v.importedFile.extension == 'xls', 'gsheet')
                                            + if(v.importedFile.extension == 'xlsm', 'gsheet')
                                            + if(v.importedFile.extension == 'xlsx', 'gsheet')
                                        }"/>
                                <!-- /File Icon -->
                            </div>
                            <div class="slds-media__body">
                                <h3 class="slds-tile__title slds-truncate" title="{!v.importedFile.name}"><a
                                            href="javascript:void(0);">{!v.importedFile.name}</a>
                                </h3>
                                <div class="slds-truncate slds-text-color_weak">
                                    {!v.importedFile.formattedSize} • {!v.importedFile.extension}
                                </div>
                            </div>
                        </article>
                    </div>

                    <div class="slds-col slds-p-top_medium">
                        <div class="slds-grid slds-grid_vertical">
                            <div class="slds-col slds-p-bottom_xx-small">
                                <a onclick=""
                                   class="slds-box slds-box_link slds-box_x-small slds-media">
                                    <div class="slds-media__figure slds-media__figure_fixed-width slds-align_absolute-center">
                                        <span class="slds-icon slds-icon_medium">
                                            <lightning:icon iconName="utility:answer"/>
                                        </span>
                                    </div>
                                    <div class="slds-media__body slds-p-around_xx-small">
                                        <h2 class="slds-truncate visualPickerHeading"
                                            title="Send for External Review">
                                            Send for External Review</h2>
                                        <p class="">Negotiate with a third party and compare redlines.</p>
                                    </div>
                                </a>
                            </div>
                            <div class="slds-col slds-p-bottom_xx-small">
                                <a onclick=""
                                   class="slds-box slds-box_link slds-box_x-small slds-media">
                                    <div class="slds-media__figure slds-media__figure_fixed-width slds-align_absolute-center">
                                        <span class="slds-icon slds-icon_medium">
                                            <lightning:icon iconName="utility:approval"/>
                                        </span>
                                    </div>
                                    <div class="slds-media__body slds-p-around_xx-small">
                                        <h2 class="slds-truncate visualPickerHeading"
                                            title="Send for Approval">
                                            Send for Approval</h2>
                                        <p class="">Request approval and feedback from your teammates.</p>
                                    </div>
                                </a>
                            </div>
                            <div class="slds-col slds-p-bottom_xx-small">
                                <a onclick=""
                                   class="slds-box slds-box_link slds-box_x-small slds-media">
                                    <div class="slds-media__figure slds-media__figure_fixed-width slds-align_absolute-center">
                                        <span class="slds-icon slds-icon_medium">
                                            <lightning:icon iconName="utility:edit_form"/>
                                        </span>
                                    </div>
                                    <div class="slds-media__body slds-p-around_xx-small">
                                        <h2 class="slds-truncate visualPickerHeading"
                                            title="Send for Signature">
                                            Send for Signature</h2>
                                        <p class="">Collect signatures for this agreement with DocuSign.</p>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </aura:if>

                <div id="upload-wrapper" class="{!'slds-p-around_large' + if(not(v.currentStep == '3'), ' slds-hide','')}">

                </div>

            </div>
        </div>

        <!-- modal footer buttons -->
        <aura:set attribute="footerButtons">
            <aura:if isTrue="{!v.currentStep == '2'}">
                <div class="slds-grid slds-grid_align-spread">
                    <lightning:button class="slds-button slds-button--neutral" onclick="{!c.backButtonClicked}"
                                      label="Back">
                    </lightning:button>
                    <lightning:button class="slds-button slds-button--brand" onclick="{!c.importButtonClicked}"
                                      disabled="{!if(or(v.disableSalesforceFileImport, v.loading), true , false)}"
                                      label="Import"></lightning:button>
                </div>
            </aura:if>

            <aura:if isTrue="{!v.currentStep == '3'}">
                    <div class="slds-grid slds-grid_align-spread">
                        <lightning:button class="slds-button slds-button--neutral" onclick="{!c.uploadFileButtonClicked}"
                                          label="Back">
                        </lightning:button>
                        <lightning:button class="slds-button slds-button--brand" onclick="{!c.uploadFileImportButtonClicked}"
                                          label="Import"></lightning:button>
                    </div>
            </aura:if>

            <aura:if isTrue="{!v.currentStep == '4'}">
                <div class="slds-grid slds-align_absolute-center">
                    <lightning:button class="slds-button slds-button_neutral" onclick="{!c.clickDone}"
                                      label="Done">
                    </lightning:button>
                </div>
            </aura:if>

        </aura:set>
    </c:strike_modal>

</aura:component>
