<aura:component description="AgreementDetails" controller="AgreementsController">
    <!-- attributes -->
    <aura:attribute name="showTimeLine" type="boolean"/>
    <aura:attribute name="agreementDetails" type="Agreement"/>
    <aura:attribute name="agreementHistoryItems" type="AgreementHistoryItem[]"/>
    <aura:attribute name="modalLoading" type="Boolean"/>
    <aura:attribute name="activityLinkLabel" type="String" access="private" default="Show Activity"/>
    <aura:attribute name="sourceId" type="Id"/>
    <aura:attribute name="agreementIndex" type="Integer"/>
    <aura:attribute name="agreementActionManager" type="Object"/>
    <aura:attribute name="namespace" type="String"/>
    <aura:attribute name="uiHelper" type="Object"/>
    <aura:attribute name="canSendForSignature" type="Boolean" default="false" access="private"/>

    <ltng:require styles="{!$Resource.scmwidgetscss}"
                  scripts="{!join(',',$Resource.AgreementActionManager, $Resource.scmwidgetsjs, $Resource.uiHelper, $Resource.navUtils)}"
                  afterScriptsLoaded="{!c.onLoad}"/>
    <aura:registerEvent name="toastEvent" type="c:ToastEvent"/>
    <aura:registerEvent name="loadingEvent" type="c:LoadingEvent"/>

    <!-- placeholder div for dynamic component generation -->
    <div aura:id="detailModalContent"/>

    <!-- body -->
    <div class="slds-grid slds-grid_vertical-align-center slds-wrap slds-p-top_medium slds-p-bottom_medium slds-has-flexi-truncate">
        <div class="slds-col slds-medium-size_6-of-12 slds-large-size_6-of-12 slds-p-bottom--small">
            <article class="slds-tile slds-media">
                <div class="slds-media__figure">
                        <span class="slds-icon_container" title="description of icon when needed">
                            <c:IconByFileExtension extension="{!v.agreementDetails.extension}"/>
                        </span>
                </div>
                <div class="slds-media__body">
                    <h3 class="slds-tile__title slds-truncate" title="{!v.agreementDetails.name}"><a
                                aura:id="viewAgreementButton"
                                onclick="{!c.viewAgreement}">{!v.agreementDetails.name}</a>
                    </h3>
                    <div class="slds-tile__detail">
                        <ul class="slds-list_vertical">
                            <li class="slds-item">
                                {!$Label.c.Modified}&nbsp;
                                <lightning:formattedDateTime value="{!v.agreementDetails.modifiedDate}" year="numeric"
                                                             month="numeric" day="numeric"/>&nbsp;
                                at&nbsp;
                                <lightning:formattedDateTime value="{!v.agreementDetails.modifiedDate}" hour="2-digit"
                                                             minute="2-digit" hour12="false"/>
                            </li>
                            <li class="slds-item slds-p-top_small">
                                    <span class="{!'slds-badge' + if(v.agreementDetails.status == 'NEW',' ds-greenAgreement-status')
                                            + if(v.agreementDetails.status == 'NEW VERSION',' ds-greenAgreement-status')
                                            + if(v.agreementDetails.status == 'PENDING REVIEW',' ds-warningAgreement-status')
                                            + if(v.agreementDetails.status == 'REVIEWED',' ds-greenAgreement-status')
                                            + if(v.agreementDetails.status == 'REVIEW CANCELLED',' ds-redAgreement-status')
                                            + if(v.agreementDetails.status == 'REVIEW EXPIRED',' ds-redAgreement-status')
                                            + if(v.agreementDetails.status == 'PENDING APPROVAL',' ds-warningAgreement-status')
                                            + if(v.agreementDetails.status == 'APPROVED',' ds-greenAgreement-status')
                                            + if(v.agreementDetails.status == 'APPROVAL CANCELLED',' ds-redAgreement-status')
                                            + if(v.agreementDetails.status == 'COMPLETED',' ds-greenAgreement-status')
                                            + if(v.agreementDetails.status == 'REJECTED',' ds-redAgreement-status')
                                            + if(v.agreementDetails.status == 'SIGNED',' ds-greenAgreement-status')
                                            + if(v.agreementDetails.status == 'SIGNATURE CANCELLED',' ds-redAgreement-status')
                                            + if(v.agreementDetails.status == 'NO STATUS','  ds-greenAgreement-status')
                                            + if(v.agreementDetails.status == 'PENDING SIGNATURE',' ds-warningAgreement-status')
                                            + if(v.agreementDetails.status == 'SYSTEM ERROR',' ds-redAgreement-status')}">
                                        {!v.agreementDetails.status}
                                    </span>
                            </li>
                        </ul>

                    </div>
                </div>
            </article>
        </div>
        <div class="slds-col slds-text-align_right slds-medium-size_6-of-12 slds-large-size_6-of-12">
            <lightning:buttonMenu aura:id="editMenu" iconName="utility:edit" class="slds-p-left--xx-small"
                                  menuAlignment="right">

                <lightning:menuItem label="{!$Label.c.Download}" value="{!$Label.c.Download}"
                                    onactive="{!c.showDownloadModal}"/>

                <lightning:menuItem label="{!$Label.c.AddToSalesforce}" value="{!$Label.c.AddToSalesforce}"
                                    onactive="{!c.showAddToSalesforceModal}"/>

                <lightning:menuItem label="{!$Label.c.UploadNewVersion}" value="{!$Label.c.UploadNewVersion}"
                                    onactive="{!c.showUploadModal}"
                                    disabled="{!v.agreementDetails.status == 'COMPLETED'
                                                || v.agreementDetails.status == 'PENDING REVIEW'
                                                || v.agreementDetails.status == 'PENDING APPROVAL'}"/>


                <lightning:menuItem label="{!$Label.c.Rename}" value="{!$Label.c.Rename}"
                                    onactive="{!c.showRenameModal}"
                                    disabled="{!v.agreementDetails.status == 'PENDING REVIEW'
                                               || v.agreementDetails.status == 'PENDING APPROVAL'
                                               || v.agreementDetails.status == 'PENDING SIGNATURE'}"/>

                <lightning:menuItem label="{!$Label.c.DeleteButtonLabel}" value="{!$Label.c.DeleteButtonLabel}"
                                    onactive="{!c.showDeleteModal}"
                                    disabled="{!v.agreementDetails.status == 'PENDING REVIEW'
                                               || v.agreementDetails.status == 'PENDING APPROVAL'
                                               || v.agreementDetails.status == 'PENDING SIGNATURE'}"/>
            </lightning:buttonMenu>

            <lightning:buttonMenu aura:id="shareMenu" iconName="utility:internal_share" class="slds-p-left_xx-small"
                                  menuAlignment="right">

                <lightning:menuItem label="{!$Label.c.AgreementsShareLink}" value="{!$Label.c.AgreementsShareLink}"
                                    onactive="{!c.showShareLinkModal}"/>

                <lightning:menuItem label="{!$Label.c.AgreementsExternalReview}"
                                    value="{!$Label.c.AgreementsExternalReview}"
                                    onactive="{!c.showExternalReviewModal}"
                                    disabled="{!v.agreementDetails.status == 'PENDING REVIEW'
                                               || v.agreementDetails.status == 'PENDING APPROVAL'
                                               || v.agreementDetails.status == 'PENDING SIGNATURE'
                                               || v.agreementDetails.status == 'COMPLETED'}"/>

                <lightning:menuItem label="{!$Label.c.AgreementsInternalApproval}"
                                    value="{!$Label.c.AgreementsInternalApproval}"
                                    onactive="{!c.showInternalApprovalModal}"
                                    disabled="{!v.agreementDetails.status == 'PENDING REVIEW'
                                               || v.agreementDetails.status == 'PENDING APPROVAL'
                                               || v.agreementDetails.status == 'PENDING SIGNATURE'
                                               || v.agreementDetails.status == 'COMPLETED'}"/>

                <lightning:menuItem label="{!$Label.c.SendForSignature}"
                                    value="{!$Label.c.SendForSignature}"
                                    onactive="{!c.sendForSignature}"
                                    class="{!if(!v.canSendForSignature,'slds-hide','')}"/>

            </lightning:buttonMenu>
            <div class="slds-p-top_x-small">
                <h3 title="Activity History" class="slds-tile__title slds-truncate">
                    <a aura:id="showActivityButton" onclick="{!c.showTimeLine}">{!v.activityLinkLabel}</a>
                </h3>
            </div>
        </div>
        <div id="{!'historyContainer' + (v.agreementIndex)}"
             class="{!'slds-p-around_large ds-max-width' + if(not(v.showTimeLine), ' slds-hide','')}">

        </div>
    </div>
</aura:component>
